define(["commons","ajax","api"],function(a,t,o){$("#insertHeader").load("../../fragmentos/menu-navegacao.html");var i={calcular:function(e,a,t,o){var l=e;$.each(t,function(a,t){l-=e*(t/100)});var r=(l+=this.NaNtoDefaultValue(a,0))*(o/100);l+=r;var i=0;return $.each(t,function(a,t){i+=t}),l/=1-i/100,{valorFinal:this.NaNtoDefaultValue(l.toFixed(2),""),valorLucro:this.NaNtoDefaultValue(r.toFixed(2),"")}},NaNtoDefaultValue:function(a,t){return isNaN(a)?t:a}},l=function(a){var t=parseFloat(a[0].val()),e=parseFloat(a[1].val()),o=[];$.each(a.slice(2,5),function(a,t){o.push(i.NaNtoDefaultValue(parseFloat(t.val()),0))});var l=parseFloat(a[5].val()),r=i.calcular(t,e,o,l);$("#preco-venda").val(r.valorFinal),$("#valor-lucro").val(r.valorLucro)};$(function(){$("#produtoForm").validate();var e=[$("#preco-compra"),$("#outros-custos"),$("#icms"),$("#pis"),$("#cofins"),$("#margem-lucro")];$.each(e,function(a,t){t.off("keyup").on("keyup",function(){l(e)})}),$("#btn-search").on("click",function(){var a=$("#input-search").val();new t.Get(o["produtos.taxas.pesquisa"],{produto:a}).call().done(function(a){$("#icms").val(a.icms),$("#pis").val(a.pis),$("#cofins").val(a.cofins),l(e)}).fail(function(a){$("#msg-erro-busca-taxas").removeClass("hide").text("Não foi possível recuperar as taxas para esse produto")})}),$("#prioridade").select2({placeholder:"Selecione uma opção",allowClear:!0,theme:"bootstrap",templateResult:function(a){return split=a.text.split(","),$("<h4>"+split[0]+"</h4> <small>"+split[1]+"</small>")},templateSelection:function(a){return split=a.text.split(","),split[0]}})})});