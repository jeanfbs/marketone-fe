define(["ajax","api"],function(e,t){$("#insertHeader").load("../../fragmentos/menu-navegacao.html");var r={calcular:function(o,a,e,t){var l=o;$.each(e,function(a,e){l-=o*(e/100)});var i=(l+=this.NaNtoDefaultValue(a,0))*(t/100);l+=i;var r=0;return $.each(e,function(a,e){r+=e}),l/=1-r/100,{valorFinal:this.NaNtoDefaultValue(l.toFixed(2),""),valorLucro:this.NaNtoDefaultValue(i.toFixed(2),"")}},NaNtoDefaultValue:function(a,e){return isNaN(a)?e:a}},l=function(a){var e=parseFloat(a[0].val()),o=parseFloat(a[1].val()),t=[];$.each(a.slice(2,5),function(a,e){t.push(r.NaNtoDefaultValue(parseFloat(e.val()),0))});var l=parseFloat(a[5].val()),i=r.calcular(e,o,t,l);$("#preco-venda").val(i.valorFinal),$("#valor-lucro").val(i.valorLucro)};$(function(){$("#produtoForm").validate();var o=[$("#preco-compra"),$("#outros-custos"),$("#icms"),$("#pis"),$("#cofins"),$("#margem-lucro")];$.each(o,function(a,e){e.off("keyup").on("keyup",function(){l(o)})}),$("#btn-search").on("click",function(){var a=$("#input-search").val();new e.WebClient(t["produtos.taxas.pesquisa"],"GET",{produto:a}).call().done(function(a){$("#icms").val(a.icms),$("#pis").val(a.pis),$("#cofins").val(a.cofins),l(o)}).fail(function(a){$("#msg-erro-busca-taxas").removeClass("hide").text("Não foi possível recuperar as taxas para esse produto")})}),$("#prioridade").select2({placeholder:"Selecione uma opção",allowClear:!0,theme:"bootstrap",templateResult:function(a){return split=a.text.split(","),$("<h4>"+split[0]+"</h4> <small>"+split[1]+"</small>")},templateSelection:function(a){return split=a.text.split(","),split[0]}}),$(".photo").fileinput({language:"pt-BR",showUpload:!1,browseLabel:"",browseIcon:'<i class="fa fa-picture-o fa-fw"></i> ',removeLabel:"",removeIcon:'<i class="fa fa-trash fa-fw"></i> ',mainClass:"input-group",maxImageWidth:300,maxImageHeight:300,resizeImage:!0,allowedFileExtensions:["jpg","jpeg","png"]})})});