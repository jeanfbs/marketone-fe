define(["ajax","api"],function(t,a){var o={formatItem:function(t){return t.loading?t.text:"<div class='row'><div class='col-sm-1'><img src='"+t.imagem+"' width='75px'></div><div class='col-sm-11'><span class='select2-produto'>"+t.descricao+"</span><br><span class='select2-info'><strong>Categoria:</strong> "+t.categoria+"</span><span class='select2-info'><strong>Marca:</strong> "+t.marca+"</span><span class='select2-info'><strong>Unidade:</strong> "+t.medida+"</span></div></div>"},formatItemSelection:function(t){$("#spanCodigoBarra").text(t.codigoBarra),t.valorUnitario=isNaN(t.valorUnitario)?0:t.valorUnitario,$("#spanValorUnitario").attr("data-valor-unitario",t.valorUnitario).text(t.valorUnitario.toLocaleString()),$("#quantidade").val(1);var a=t.valorUnitario;return $("#spanTotalItem").text(a.toLocaleString()),$("#foto-produto").attr("src",t.imagem),$("#produto").attr({"data-codigo-barra":t.codigoBarra,"data-descricao":t.descricao,"data-quantidade":1,"data-valor-unitario":t.valorUnitario,"data-total":a}),t.descricao||t.text}},r=function(t){var a=$.Deferred(),o=parseInt($("#itens tbody tr").length)+1,r="<tr data-item="+btoa(JSON.stringify(t))+'><td class="text-center">'+o+"</td><td>"+t.codigoBarra+"</td><td>"+t.descricao+"</td><td>"+t.quantidade+"</td><td>"+t.valorUnitario+"</td><td>"+t.valorItem+'</td><td class="col-sm-1 text-center"><a href="#" class="text-danger removeItem" data-toggle="tooltip" data-placement="right" title="Revover Item"><i class="fa fa-times fa-fw" aria-hidden="true"></i></a></td></tr>';return $("#itens").append(r),a.resolve(),a},e=function(){var r=0;$("#itens tbody tr").each(function(t,a){var o=JSON.parse(atob($(a).attr("data-item")));r+=o.valorItem}),$("#spanValorTotal").text(r.toLocaleString())},n=function(){var o=1;$("#itens tbody tr").each(function(t,a){$(a).children("td:eq(0)").text(o),o++})},i=function(){$("#totalItens").text(parseInt($("#itens tbody tr").length))};$(function(){$("#insertHeader").load("../../fragmentos/menu-navegacao.html"),$("#quantidade").on("keyup",function(){var t=/[^0-9]/g;$(this).val().match(t)&&$(this).val($(this).val().replace(t,""))}),$("#quantidade").focusout(function(){var t=parseInt($(this).val());isNaN(t)&&(t=1,$(this).val(1));var a=parseFloat($("#spanValorUnitario").attr("data-valor-unitario"))*t;$("#spanTotalItem").text(a.toLocaleString()),$("#produto").attr("data-quantidade",t),$("#produto").attr("data-total",a)}),$("#addItem").off("click").on("click",function(){var t={};t.codigoBarra=$("#produto").attr("data-codigo-barra"),t.descricao=$("#produto").attr("data-descricao"),t.quantidade=parseInt($("#produto").attr("data-quantidade")),t.valorUnitario=parseFloat($("#produto").attr("data-valor-unitario")),t.valorItem=parseFloat($("#produto").attr("data-total")),$.when(r(t)).then(e()),i()}),$(document).off("click",".removeItem").on("click",".removeItem",function(){e(),$(this).parents("tr").remove(),n(),i()}),$("#clearAll").on("click",function(){$("#itens tbody").empty(),e(),i()}),$("#busca-produto").select2({theme:"bootstrap",ajax:{url:a["pdv.pesquisa.produto"],dataType:"json",data:function(t){return{value:t.term}},processResults:function(t,a){return{results:$.map(t,function(t){return t.id=t.codigoBarra,t.text=t.descricao,t})}},cache:!1},placeholder:"Buscar Produtos",escapeMarkup:function(t){return t},minimumInputLength:1,templateResult:o.formatItem,templateSelection:o.formatItemSelection})})});