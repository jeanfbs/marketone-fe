define(["ajax","keyevent","api"],function(n,r,i){var s=function(t){var e={};return e.response=t,e.quantidade=t.quantidade,e.totalItem=parseFloat(t.valorUnitario)*t.quantidade,e.response.valorUnitario=isNaN(e.response.valorUnitario)?0:e.response.valorUnitario,$("#descricao").text(t.descricao),$("#spanCodigoBarra").text(t.codigoBarra),$("#spanValorUnitario").text(t.valorUnitario.toLocaleString()),$("#spanQuantidade").text(t.quantidade),$("#spanTotalItem").text(e.totalItem.toLocaleString()),e},d=function(t){var e=$.Deferred(),a=parseInt($("#itens tbody tr").length)+1,o="<tr data-item="+btoa(JSON.stringify(t))+'><td class="text-center">'+a+"</td><td>"+t.response.codigoBarra+"</td><td>"+t.response.descricao+"</td><td>"+t.quantidade+"</td><td>"+t.response.valorUnitario+"</td><td>"+t.totalItem+'</td><td class="col-sm-1 text-center"><a href="#" class="text-danger removeItem" data-toggle="tooltip" data-placement="right" title="Remover Item"><i class="fa fa-times fa-fw" aria-hidden="true"></i></a></td></tr>';$("#itens").append(o);var n=parseInt($("#itens tbody").height());return $(".dataTables_scrollBody").scrollTop(n),e.resolve(),e},l=function(){var o=0;$("#itens tbody tr").each(function(t,e){var a=JSON.parse(atob($(e).attr("data-item")));o+=a.totalItem}),$("#spanValorTotal").text(o.toLocaleString())},t=function(){var a=1;$("#itens tbody tr").each(function(t,e){$(e).children("td:eq(0)").text(a),a++})},c=function(){$(".dataTables_scrollFootInner").find("td[colspan=2]").text(parseInt($("#itens tbody tr").length))};$(function(){$("#insertHeader").load("../../fragmentos/menu-navegacao.html"),$("#navbar-theme").addClass("hide");$("#itens").DataTable({paging:!1,ordering:!1,info:!1,searching:!1,scrollY:"200px",scrollCollapse:!0,oLanguage:{sZeroRecords:"Nenhum produto foi adicionado"}});$("#itens tbody").empty(),$("#hideMenu").on("click",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),$("#navbar-theme").removeClass("hide").fadeIn(200)):($(this).addClass("selected"),$("#navbar-theme").removeClass("hide").fadeOut(200))}),(new r.Registry).add(r.Shorcut.F9,function(){$("#busca-produto").focus().select()}),$("#busca-produto").on("keyup",function(t){if(t.keyCode==r.Shorcut.ENTER){var e=$(this).val();$(this).val("");var a=0,o=1;1==e.indexOf("*")?(a=parseInt(e.split("*")[1]),o=parseInt(e.split("*")[0])):a=parseInt(e),new n.WebClient(i["pdv.pesquisa.produto"]+"?codigoBarra="+a,"GET").call().done(function(t){t[0].quantidade=o;var e=s(t[0]);$.when(d(e)).then(l()),c()}).fail(function(t){alert("erro")})}}),$(document).off("click",".removeItem").on("click",".removeItem",function(){l(),$(this).parents("tr").remove(),t(),c()}),$("#clearAll").on("click",function(){$("#itens tbody").empty(),l(),c()})})});